<!doctype html>
<html lang="zh-Hans">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>JKang Arcade</title>
  <meta name="description" content="JKang Arcade Â· Futuristic colorful arcade Â· Play responsibly Â· No cash-out" />
  <style>
    :root{
      --bg:#050507;
      --text:#F6F7FB;
      --muted:#A7AAB5;
      --line:rgba(255,255,255,.12);
      --glass:rgba(255,255,255,.06);
      --glass2:rgba(255,255,255,.02);
      --shadow:0 26px 90px rgba(0,0,0,.62);
      --radius:22px;
      --gold:#FFD700;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial,sans-serif;
      color:var(--text);
      background: radial-gradient(900px 520px at 18% 30%, rgba(255,215,130,.18), transparent 60%),
                  radial-gradient(900px 520px at 80% 72%, rgba(120,200,255,.14), transparent 60%),
                  radial-gradient(780px 480px at 62% 20%, rgba(180,120,255,.14), transparent 60%),
                  var(--bg);
      overflow-x:hidden;
    }
    a{color:inherit;text-decoration:none}

    /* FX layers */
    canvas#neon, canvas#confetti { position:fixed; inset:0; width:100%; height:100%; z-index:0; pointer-events:none; }
    .noise{
      position:fixed; inset:0; z-index:1; pointer-events:none; opacity:.10; mix-blend-mode:overlay;
      background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='200'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.9' numOctaves='2' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='200' height='200' filter='url(%23n)' opacity='.22'/%3E%3C/svg%3E");
    }
    .glow{
      position:fixed; width:560px; height:560px; border-radius:50%;
      transform: translate(-50%,-50%);
      background: radial-gradient(circle at center,
        rgba(255,215,130,.16) 0%,
        rgba(180,120,255,.12) 24%,
        rgba(120,200,255,.10) 46%,
        rgba(255,255,255,0) 62%);
      filter: blur(2px);
      z-index:2;
      pointer-events:none;
      opacity:.95;
      mix-blend-mode:screen;
    }

    .wrap{ position:relative; z-index:3; max-width:1100px; margin:0 auto; padding:16px 14px 90px; }
    .nav{
      position:sticky; top:0; z-index:20;
      display:flex; align-items:center; justify-content:space-between;
      padding:12px 0;
      border-bottom:1px solid var(--line);
      backdrop-filter: blur(14px);
      background: linear-gradient(to bottom, rgba(5,5,7,.90), rgba(5,5,7,.40));
    }
    .brand{
      font-weight:1000; letter-spacing:.25em; text-transform:uppercase; font-size:13px;
      display:flex; align-items:center; gap:10px;
    }
    .dot{
      width:10px; height:10px; border-radius:50%;
      background: radial-gradient(circle, rgba(255,215,130,1), rgba(255,215,130,.1));
      box-shadow: 0 0 18px rgba(255,215,130,.35);
    }
    .links{ display:flex; gap:10px; color:var(--muted); font-size:13px; align-items:center; flex-wrap:wrap; }
    .links a{
      padding:8px 10px; border-radius:999px; border:1px solid transparent;
      transition:.2s ease; background:rgba(255,255,255,.00);
    }
    .links a:hover{ border-color:var(--line); color:var(--text); transform: translateY(-1px); background: rgba(255,255,255,.03); }

    .hero{
      padding:34px 0 6px;
      display:grid; gap:16px;
      grid-template-columns: 1fr;
    }
    @media(min-width:980px){ .hero{ grid-template-columns: 1.08fr .92fr; align-items:stretch; } }

    .kicker{
      display:inline-flex; align-items:center; gap:10px;
      color:rgba(255,255,255,.85);
      letter-spacing:.18em; text-transform:uppercase; font-size:12px;
    }
    .kicker .pulse{
      width:10px;height:10px;border-radius:50%;
      background: rgba(120,255,180,.95);
      box-shadow: 0 0 18px rgba(120,255,180,.45);
      animation:pulse 1.6s ease-in-out infinite;
    }
    @keyframes pulse{ 0%,100%{ transform:scale(1); opacity:.8 } 50%{ transform:scale(1.35); opacity:1 } }

    h1{
      margin:10px 0 10px;
      font-size:62px; line-height:1.03; letter-spacing:.02em;
      background: linear-gradient(90deg,#fff,#FFD700,#FFB800,#B478FF,#7CC8FF);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
      text-shadow: 0 0 28px rgba(255,215,130,.10);
    }
    .sub{
      color:var(--muted);
      font-size:15px; line-height:1.9; max-width:780px;
    }

    .cta{ display:flex; gap:10px; flex-wrap:wrap; margin-top:16px; }
    .btn{
      display:inline-flex; align-items:center; gap:10px;
      padding:12px 14px; border-radius:14px;
      border:1px solid var(--line);
      background: rgba(255,255,255,.06);
      box-shadow: 0 12px 34px rgba(0,0,0,.35);
      transition:.2s ease; font-weight:900; cursor:pointer;
      user-select:none;
      position:relative; overflow:hidden;
    }
    .btn::after{
      content:""; position:absolute; inset:-2px;
      background: radial-gradient(220px 120px at var(--mx,50%) var(--my,50%),
        rgba(255,215,130,.22), rgba(180,120,255,.14), rgba(120,200,255,.12), transparent 60%);
      opacity:0; transition:.2s ease;
      pointer-events:none;
    }
    .btn:hover::after{ opacity:1; }
    .btn:hover{ transform: translateY(-1px); background: rgba(255,255,255,.10); }
    .btn.primary{ background: rgba(255,255,255,.92); color:#000; border-color:transparent; }
    .btn.primary:hover{ background:#fff; }

    .card{
      border:1px solid var(--line);
      border-radius: var(--radius);
      background: linear-gradient(to bottom, var(--glass), var(--glass2));
      box-shadow: var(--shadow);
      overflow:hidden;
      position:relative;
    }
    .card::before{
      content:""; position:absolute; inset:-1px;
      background: linear-gradient(135deg, rgba(255,215,130,.18), rgba(180,120,255,.12), rgba(120,200,255,.10), rgba(255,255,255,0));
      opacity:.22; pointer-events:none;
    }
    .in{ position:relative; padding:16px; }
    .grid{ display:grid; gap:14px; grid-template-columns: 1fr; margin-top:14px; }
    @media(min-width:980px){ .grid{ grid-template-columns: 1fr 1fr; } }

    .tiles{ display:grid; gap:12px; grid-template-columns: 1fr; margin-top:14px; }
    @media(min-width:980px){ .tiles{ grid-template-columns: 1fr 1fr 1fr; } }
    .tile{
      border:1px solid rgba(255,255,255,.12);
      border-radius: 18px;
      background: rgba(255,255,255,.04);
      padding:14px;
      transition:.2s ease;
      position:relative;
      overflow:hidden;
      min-height:128px;
    }
    .tile:hover{ transform: translateY(-2px); background: rgba(255,255,255,.07); }
    .tile h3{ margin:0; font-size:16px; letter-spacing:.02em; }
    .tile p{ margin:8px 0 0; color:var(--muted); font-size:13px; line-height:1.7; }

    /* image blocks */
    .shot{
      border:1px solid rgba(255,255,255,.12);
      border-radius: var(--radius);
      overflow:hidden;
      background: rgba(255,255,255,.02);
      position:relative;
    }
    .shot img{
      width:100%; height:100%;
      display:block;
      object-fit:cover;
      filter: saturate(1.15) contrast(1.05);
      transform: scale(1.02);
    }
    .cap{
      position:absolute; left:12px; bottom:12px;
      padding:8px 10px;
      border-radius:999px;
      background: rgba(0,0,0,.35);
      border:1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(10px);
      font-size:12px;
      color:rgba(255,255,255,.92);
    }

    /* GAME: 4-digit reels */
    .gameBox{ margin-top:14px; }
    .reels{ display:flex; gap:12px; justify-content:center; flex-wrap:wrap; margin-top:10px; }
    .reel{
      width:78px; height:86px;
      border-radius: 999px;
      display:flex; align-items:center; justify-content:center;
      font-size:34px; font-weight:1000;
      border:1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.03));
      box-shadow: 0 18px 60px rgba(0,0,0,.55);
      user-select:none;
      position:relative;
    }
    .reel.locked{
      border-color: rgba(255,215,130,.55);
      box-shadow: 0 18px 80px rgba(255,215,130,.12);
    }
    .hint{ text-align:center; color:var(--muted); font-size:13px; margin-top:10px; line-height:1.7; }
    .tagRow{ display:flex; gap:8px; flex-wrap:wrap; margin-top:10px; justify-content:center; }
    .tag{
      font-size:12px;
      padding:8px 10px;
      border:1px solid rgba(255,255,255,.12);
      border-radius:999px;
      background: rgba(255,255,255,.03);
      color: rgba(255,255,255,.84);
    }

    .jackpot{
      position:fixed; inset:0; z-index:50;
      display:none; align-items:center; justify-content:center;
      background: radial-gradient(700px 500px at 50% 45%, rgba(255,215,130,.20), rgba(180,120,255,.12), rgba(0,0,0,.92) 70%);
      backdrop-filter: blur(8px);
    }
    .jackpot.show{ display:flex; }
    .jack{
      text-align:center;
      padding:18px 16px;
      border-radius: 28px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      box-shadow: 0 26px 90px rgba(0,0,0,.65);
      transform: scale(.95);
      animation: pop .45s ease forwards;
    }
    @keyframes pop{ to{ transform: scale(1) } }
    .jack h2{
      margin:0;
      font-size:44px;
      letter-spacing:.12em;
      text-transform:uppercase;
      background: linear-gradient(90deg,#fff,#FFD700,#FFB800);
      -webkit-background-clip:text; -webkit-text-fill-color:transparent;
      text-shadow: 0 0 38px rgba(255,215,130,.20);
    }
    .jack p{ margin:10px 0 0; color:rgba(255,255,255,.85); line-height:1.8; }

    footer{
      margin-top:18px;
      color:var(--muted);
      font-size:12px;
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      opacity:.92;
    }
  </style>
</head>
<body>
  <canvas id="neon"></canvas>
  <canvas id="confetti"></canvas>
  <div class="noise"></div>
  <div class="glow" id="glow"></div>

  <div class="jackpot" id="jackpot">
    <div class="jack">
      <h2>JACKPOT</h2>
      <p>Ultra hit! çº¯å¨±ä¹ç‰¹æ•ˆï¼Œä¸å…‘æ¢ç°é‡‘ã€‚<br/>è®°å¾—ç†æ€§æ¶ˆè´¹ï¼Œä¼‘æ¯ä¸€ä¸‹æ›´å¼€å¿ƒã€‚</p>
      <div style="margin-top:14px">
        <button class="btn primary" onclick="closeJackpot()">OK</button>
      </div>
    </div>
  </div>

  <div class="wrap">
    <div class="nav">
      <div class="brand"><span class="dot"></span>JKANG ARCADE</div>
      <div class="links">
        <a href="#games">Games</a>
        <a href="#draw4">Draw4</a>
        <a href="/legacy/index.html">Legacy</a>
      </div>
    </div>

    <section class="hero">
      <div class="card">
        <div class="in">
          <div class="kicker"><span class="pulse"></span>Fresh Â· Colorful Â· Animated</div>
          <h1>å¨±ä¹åŸé£<br/>çº¿ä¸Šå¨±ä¹</h1>
          <div class="sub">
            è¿™æ˜¯å…¨æ–°ç‰ˆæœ¬ï¼šæ›´åŠ²çˆ†ã€æ›´æœ‰åŠ¨ç”»ã€æ›´åƒçœŸæ­£çš„å¨±ä¹å…ã€‚<br/>
            ç©æ³•ï¼šå…è´¹ç‚¹æ•°ï¼ˆBï¼‰ + å……å€¼è´­ä¹°ç‚¹æ•°ï¼ˆAï¼Œæ— æç°ï¼‰ã€‚<br/>
            å†…ç½®ç†æ€§æ¶ˆè´¹ï¼šæ¯æ—¥ä¸Šé™ / å†·é™æé†’ / é€æ˜è®°å½•ï¼ˆåç»­æ¥ Supabase åå°ï¼‰ã€‚
          </div>

          <div class="cta">
            <a class="btn primary" href="#draw4">ğŸ° Start Draw4</a>
            <a class="btn" href="#games">ğŸ® Game Lobby</a>
            <a class="btn" href="/legacy/index.html">ğŸ“¦ Old version</a>
          </div>

          <div class="tagRow">
            <div class="tag">âœ… Play responsibly</div>
            <div class="tag">âœ… No cash-out</div>
            <div class="tag">âœ… Big animations</div>
            <div class="tag">âœ… Mobile-first</div>
          </div>
        </div>
      </div>

      <div class="shot" style="min-height:320px">
        <img src="/legacy/IMG_0621.png" alt="Hero image" onerror="this.style.display='none'">
        <div class="cap">Hero Visual</div>
      </div>
    </section>

    <section id="games" class="grid">
      <div class="tile">
        <h3>ğŸ¡ Lucky Wheel (NEW)</h3>
        <p>ä¸‹ä¸€æ­¥æˆ‘ä¼šç»™ä½ ä¸€ä¸ªæ–°è½¬ç›˜ï¼š3Dæ—‹è½¬ + å½©çº¸ + å£°éŸ³ + æŠ½å¥–åŠ¨ç”»ã€‚</p>
        <div style="margin-top:12">
          <button class="btn" onclick="toast('Wheel: Coming next step')">Preview</button>
        </div>
      </div>
      <div class="tile">
        <h3>ğŸ Lootbox (NEW)</h3>
        <p>å¼€ç®±åŠ¨ç”»ä¼šæ›´ç‚¸ï¼šå…‰æ‰« + çˆ†é—ª + å›¾ç‰‡å¡ç‰‡æ‰è½ã€‚</p>
        <div style="margin-top:12">
          <button class="btn" onclick="toast('Lootbox: Coming next step')">Preview</button>
        </div>
      </div>
      <div class="tile">
        <h3>ğŸ’³ Wallet + Recharge</h3>
        <p>ä¸‹ä¸€æ­¥æ¥ Supabaseï¼šç™»å½•ã€ä½™é¢ã€æ¯æ—¥ä¸Šé™ã€Stripe å……å€¼è‡ªåŠ¨åŠ ç‚¹ã€‚</p>
        <div style="margin-top:12">
          <button class="btn" onclick="toast('Wallet/Admin: Next step')">Info</button>
        </div>
      </div>
    </section>

    <section class="grid" style="margin-top:14px">
      <div class="shot" style="min-height:240px">
        <img src="/legacy/IMG_0622.png" alt="Pack image" onerror="this.style.display='none'">
        <div class="cap">Product / Content</div>
      </div>
      <div class="shot" style="min-height:240px">
        <img src="/legacy/IMG_0623.png" alt="No1 image" onerror="this.style.display='none'">
        <div class="cap">Highlight Visual</div>
      </div>
    </section>

    <section id="draw4" class="card gameBox" style="margin-top:14px">
      <div class="in">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap">
          <div>
            <div class="kicker" style="margin-bottom:6px"><span class="pulse"></span>New Mini Game</div>
            <div style="font-size:20px;font-weight:1000">ğŸ° Draw4 Â· 4å·ç æŠ½é€‰ï¼ˆçœŸåŠ¨ç”»ï¼‰</div>
            <div class="sub" style="margin-top:6px">ç‚¹æ•°å­—å¯é”å®šï¼ˆé”ä½ä¸å˜ï¼‰ï¼ŒæŒ‰ Draw å¼€å§‹æ»šåŠ¨ã€‚å‡ºç°å››è¿å·ä¼šè§¦å‘ Jackpot ç‰¹æ•ˆã€‚</div>
          </div>
          <div style="display:flex;gap:10px;flex-wrap:wrap">
            <button class="btn primary" onclick="draw(false)" id="btnDraw">Draw</button>
            <button class="btn" onclick="draw(true)" id="btnTurbo">Turbo</button>
            <button class="btn" onclick="copyCode()">Copy</button>
          </div>
        </div>

        <div class="reels" id="reels">
          <div class="reel" data-i="0" onclick="toggleLock(0)">0</div>
          <div class="reel" data-i="1" onclick="toggleLock(1)">0</div>
          <div class="reel" data-i="2" onclick="toggleLock(2)">0</div>
          <div class="reel" data-i="3" onclick="toggleLock(3)">0</div>
        </div>

        <div class="hint" id="hint">Tap æ•°å­—å¯ Lockã€‚ç†æ€§æ¶ˆè´¹æç¤ºï¼šç©ä¹…äº†è®°å¾—ä¼‘æ¯ã€‚</div>
      </div>
    </section>

    <div class="card" style="margin-top:14px">
      <div class="in" style="display:flex;align-items:center;justify-content:space-between;gap:10px;flex-wrap:wrap">
        <div class="sub">
          <b style="color:#fff">ä¸‹ä¸€æ­¥ï¼ˆæˆ‘ä¼šä¸€æ­¥ä¸€æ­¥æ•™ä½ ï¼‰</b><br/>
          1) æ–°å»º /walletï¼ˆä½™é¢ã€ä¸Šé™ã€å……å€¼æ¡£ä½ï¼‰<br/>
          2) æ–°å»º /adminï¼ˆä½ èƒ½å¼€å…³æ¸¸æˆã€è°ƒå‚æ•°ã€çœ‹è®°å½•ï¼‰<br/>
          3) Supabase æ¥å…¥ + Stripe webhook è‡ªåŠ¨åŠ ç‚¹
        </div>
        <div>
          <a class="btn primary" href="/legacy/index.html">Legacy backup</a>
        </div>
      </div>
    </div>

    <footer>
      <div>Â© <span id="y"></span> JKang Arcade</div>
      <div>Concept v2 Â· Colorful UI Â· Animations</div>
    </footer>
  </div>

  <script>
    document.getElementById("y").textContent = new Date().getFullYear();

    // mouse glow
    const glow = document.getElementById("glow");
    window.addEventListener("mousemove", (e)=>{
      glow.style.left = e.clientX + "px";
      glow.style.top  = e.clientY + "px";
      document.documentElement.style.setProperty("--mx", e.clientX + "px");
      document.documentElement.style.setProperty("--my", e.clientY + "px");
    }, {passive:true});

    // toast
    let toastTimer;
    function toast(msg){
      clearTimeout(toastTimer);
      let el = document.getElementById("toast");
      if(!el){
        el = document.createElement("div");
        el.id="toast";
        el.style.position="fixed";
        el.style.left="50%";
        el.style.bottom="20px";
        el.style.transform="translateX(-50%)";
        el.style.zIndex="60";
        el.style.padding="10px 12px";
        el.style.borderRadius="999px";
        el.style.border="1px solid rgba(255,255,255,.14)";
        el.style.background="rgba(0,0,0,.55)";
        el.style.backdropFilter="blur(10px)";
        el.style.color="rgba(255,255,255,.92)";
        el.style.fontSize="13px";
        el.style.boxShadow="0 18px 60px rgba(0,0,0,.55)";
        document.body.appendChild(el);
      }
      el.textContent = msg;
      el.style.opacity="1";
      toastTimer = setTimeout(()=>{ el.style.opacity="0"; }, 1800);
    }

    // neon particles background
    const cn = document.getElementById("neon");
    const nx = cn.getContext("2d");
    let w,h,dpr;
    function resize(){
      dpr = Math.max(1, Math.min(2, devicePixelRatio||1));
      w = cn.width = Math.floor(innerWidth*dpr);
      h = cn.height= Math.floor(innerHeight*dpr);
      cn.style.width = innerWidth+"px";
      cn.style.height= innerHeight+"px";
    }
    resize(); addEventListener("resize", resize);

    const N = Math.floor(Math.min(210, Math.max(120, innerWidth/7)));
    const pts = Array.from({length:N}).map(()=>({
      x:Math.random()*w, y:Math.random()*h,
      vx:(Math.random()*2-1)*0.26*dpr,
      vy:(Math.random()*2-1)*0.18*dpr,
      r:(Math.random()*2.2+0.8)*dpr,
      h: Math.random()<0.33?45:(Math.random()<0.5?270:200),
      a: Math.random()*0.7+0.15
    }));
    function tick(){
      nx.clearRect(0,0,w,h);
      for(const p of pts){
        p.x+=p.vx; p.y+=p.vy;
        if(p.x<-60)p.x=w+60; if(p.x>w+60)p.x=-60;
        if(p.y<-60)p.y=h+60; if(p.y>h+60)p.y=-60;
        nx.beginPath();
        nx.fillStyle = `hsla(${p.h},90%,70%,${p.a*0.22})`;
        nx.arc(p.x,p.y,p.r,0,Math.PI*2);
        nx.fill();
      }
      requestAnimationFrame(tick);
    }
    tick();

    // confetti
    const cf = document.getElementById("confetti");
    const cx = cf.getContext("2d");
    let conf = [];
    function resizeCf(){
      cf.width = Math.floor(innerWidth*dpr);
      cf.height= Math.floor(innerHeight*dpr);
      cf.style.width = innerWidth+"px";
      cf.style.height= innerHeight+"px";
    }
    resizeCf(); addEventListener("resize", resizeCf);
    function burst(n=120){
      for(let i=0;i<n;i++){
        conf.push({
          x: cf.width*0.5 + (Math.random()*180-90)*dpr,
          y: cf.height*0.28 + (Math.random()*80-40)*dpr,
          vx:(Math.random()*2-1)*3.6*dpr,
          vy:(Math.random()*-2-0.7)*3.9*dpr,
          s:(Math.random()*3.2+2.0)*dpr,
          a:1,
          h: Math.random()<0.34 ? 45 : (Math.random()<0.5 ? 270 : 200),
          rot: Math.random()*Math.PI
        });
      }
    }
    function tickCf(){
      cx.clearRect(0,0,cf.width,cf.height);
      for(let i=conf.length-1;i>=0;i--){
        const p=conf[i];
        p.vy += 0.12*dpr;
        p.x += p.vx;
        p.y += p.vy;
        p.a *= 0.985;
        p.rot += 0.12;
        cx.save();
        cx.translate(p.x,p.y);
        cx.rotate(p.rot);
        cx.fillStyle = `hsla(${p.h},90%,70%,${p.a})`;
        cx.fillRect(-p.s/2,-p.s/2,p.s,p.s*0.62);
        cx.restore();
        if(p.a<0.06 || p.y>cf.height+80) conf.splice(i,1);
      }
      requestAnimationFrame(tickCf);
    }
    tickCf();

    // Draw4 game
    let digits=[0,0,0,0];
    let locks=[false,false,false,false];
    let rolling=false;
    let played=0;
    const reels=[...document.querySelectorAll(".reel")];
    function render(){
      reels.forEach((el,i)=>{
        el.textContent = String(digits[i]);
        el.classList.toggle("locked", locks[i]);
      });
    }
    render();

    function toggleLock(i){
      if(rolling) return;
      locks[i]=!locks[i];
      render();
      toast(locks[i] ? `Locked #${i+1}` : `Unlocked #${i+1}`);
    }

    function rarity(code){
      if(/(\d)\1\1\1/.test(code)) return "ULTRA";
      const c={}; for(const ch of code){ c[ch]=(c[ch]||0)+1; }
      const max=Math.max(...Object.values(c));
      if(max===3) return "EPIC";
      if(max===2) return "RARE";
      return "COMMON";
    }

    async function draw(turbo){
      if(rolling) return;
      rolling=true;
      document.getElementById("btnDraw").disabled=true;
      document.getElementById("btnTurbo").disabled=true;

      const ms = turbo ? 650 : 1300;
      const step = turbo ? 45 : 70;
      const start = performance.now();

      const timer = setInterval(()=>{
        digits = digits.map((d,i)=> locks[i] ? d : Math.floor(Math.random()*10));
        render();
      }, step);

      while(performance.now()-start < ms){
        await new Promise(r=>setTimeout(r, 20));
      }
      clearInterval(timer);

      digits = digits.map((d,i)=> locks[i] ? d : Math.floor(Math.random()*10));
      render();

      const code = digits.join("");
      const r = rarity(code);

      played++;
      if(played % 10 === 0){
        toast("ç†æ€§æç¤ºï¼šä½ å·²ç©äº†10æ¬¡ï¼Œä¼‘æ¯ä¸€ä¸‹æ›´å¼€å¿ƒã€‚");
      }

      if(r !== "COMMON") burst(r==="RARE"?90:r==="EPIC"?150:260);
      if(r === "ULTRA") openJackpot();

      document.getElementById("hint").innerHTML =
        `å½“å‰å·ç ï¼š<b style="color:#fff">${code}</b> Â· è¯„çº§ï¼š<b style="color:#fff">${r}</b>`;

      rolling=false;
      document.getElementById("btnDraw").disabled=false;
      document.getElementById("btnTurbo").disabled=false;
    }

    function copyCode(){
      const code = digits.join("");
      navigator.clipboard?.writeText(code);
      toast("Copied: " + code);
    }

    function openJackpot(){
      document.getElementById("jackpot").classList.add("show");
      // little screen shake
      document.body.animate([{transform:"translateX(0)"},{transform:"translateX(-6px)"},{transform:"translateX(6px)"},{transform:"translateX(0)"}],
        {duration:260,iterations:2});
      burst(300);
    }
    function closeJackpot(){
      document.getElementById("jackpot").classList.remove("show");
    }
    window.closeJackpot = closeJackpot;
  </script>
</body>
</html>
