async function sendOtp(){
  try{
    const email = S("email").value.trim();
    if(!email){ S("loginMsg").textContent="请输入邮箱"; alert("请输入邮箱"); return; }

    S("loginMsg").textContent="Sending OTP...";
    const { data, error } = await supabase.auth.signInWithOtp({
      email,
      options: {
        emailRedirectTo: "https://jkang.vercel.app"
      }
    });

    if(error){
      S("loginMsg").textContent = "错误: " + error.message;
      alert("错误: " + error.message);
      return;
    }

    S("loginMsg").textContent="已发送登录邮件，去邮箱点击链接即可进入。";
    alert("已发送登录邮件，请查收邮箱");
  }catch(e){
    const msg = (e && e.message) ? e.message : String(e);
    S("loginMsg").textContent = "JS 异常: " + msg;
    alert("JS 异常: " + msg);
  }
}
