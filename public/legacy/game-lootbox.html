<!DOCTYPE html>
<html lang="zh-Hans">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Loot Box Â· Jkang</title>
<style>
  :root{--bg:#050507;--text:#F6F7FB;--muted:#A7AAB5;--line:rgba(255,255,255,.12);--r:22px}
  *{box-sizing:border-box}
  body{
    margin:0;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial;
    background:
      radial-gradient(900px 500px at 50% 0%, rgba(255,255,255,.10), transparent 60%),
      radial-gradient(700px 420px at 90% 80%, rgba(180,120,255,.12), transparent 60%),
      var(--bg);
    color:var(--text);
  }
  a{color:inherit;text-decoration:none}
  .wrap{max-width:760px;margin:0 auto;padding:18px 14px 80px}
  .top{display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid var(--line)}
  .brand{font-weight:900;letter-spacing:.18em;text-transform:uppercase;font-size:12px}
  .card{
    margin-top:16px;border:1px solid var(--line);border-radius:var(--r);
    background:linear-gradient(to bottom, rgba(255,255,255,.06), rgba(255,255,255,.02));
    padding:16px; position:relative; overflow:hidden;
  }
  h1{margin:0;font-size:28px}
  p{margin:8px 0;color:var(--muted);line-height:1.75}
  .hud{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
  .pill{padding:8px 10px;border:1px solid var(--line);border-radius:999px;color:var(--muted);background:rgba(255,255,255,.02)}
  .boxArea{
    margin-top:14px; height:280px;
    border-radius:var(--r); border:1px solid var(--line);
    display:flex;align-items:center;justify-content:center;flex-direction:column;gap:10px;
    position:relative; overflow:hidden;
    background:radial-gradient(380px 220px at 50% 20%, rgba(255,255,255,.10), rgba(255,255,255,.02));
    user-select:none;
  }
  .crate{
    width:150px;height:150px;border-radius:26px;
    border:1px solid rgba(255,255,255,.14);
    background:linear-gradient(135deg, rgba(255,255,255,.08), rgba(255,255,255,.02));
    box-shadow: 0 18px 60px rgba(0,0,0,.55);
    display:flex;align-items:center;justify-content:center;
    font-size:44px;
    transform: translateZ(0);
  }
  .btnRow{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  button{
    padding:12px 14px;border-radius:14px;border:1px solid var(--line);
    background:rgba(255,255,255,.06);color:var(--text);font-weight:900;
  }
  button.primary{background:rgba(255,255,255,.92);color:#000;border-color:transparent}
  button:active{transform:scale(.98)}
  .result{
    margin-top:14px;
    border:1px solid var(--line);border-radius:18px;
    padding:14px;background:rgba(255,255,255,.02);
  }
  .rarity{
    display:inline-flex;align-items:center;gap:8px;
    padding:7px 10px;border-radius:999px;border:1px solid var(--line);
    font-size:12px;color:rgba(255,255,255,.86);
  }
  .r-common{background:rgba(255,255,255,.06)}
  .r-rare{background:rgba(120,200,255,.10)}
  .r-epic{background:rgba(180,120,255,.12)}
  .r-legend{background:rgba(255,215,120,.12)}
  .itemName{margin:10px 0 0;font-size:18px;font-weight:900}
  .small{color:var(--muted);font-size:13px;line-height:1.7;margin-top:6px}
  .log{margin-top:10px;color:var(--muted);font-size:13px;line-height:1.7;max-height:140px;overflow:auto}
  .flash{
    position:absolute;inset:-200px;
    background:conic-gradient(from 180deg, rgba(255,255,255,0), rgba(255,255,255,.25), rgba(255,255,255,0));
    opacity:0; pointer-events:none;
    animation:none;
  }
  @keyframes spin { to{transform:rotate(360deg)} }
  @keyframes pop { 0%{transform:scale(.98)} 60%{transform:scale(1.03)} 100%{transform:scale(1)} }
  .shake{animation:pop .25s ease}
</style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div class="brand">Loot Box</div>
    <div style="color:#A7AAB5;font-size:13px"><a href="games.html">Back</a></div>
  </div>

  <div class="card">
    <h1>ğŸ å¼€ç®±ï¼ˆçº¯å¨±ä¹ï¼‰</h1>
    <p>è¿æŠ½å¾ˆä¸Šå¤´ï¼šæ™®é€š / ç¨€æœ‰ / å²è¯— / ä¼ è¯´ã€‚å«â€œä¿åº•æœºåˆ¶â€ã€‚</p>

    <div class="hud">
      <div class="pill">Coins: <span id="coins">100</span></div>
      <div class="pill">Streak: <span id="streak">0</span></div>
      <div class="pill">Legend Pity: <span id="pity">0</span>/20</div>
      <div class="pill">Best Item: <span id="best">None</span></div>
    </div>

    <div class="boxArea" id="area">
      <div class="flash" id="flash"></div>
      <div class="crate" id="crate">ğŸ</div>
      <div style="color:var(--muted);font-size:13px">Tap Open / å¼€ç®±</div>
    </div>

    <div class="btnRow">
      <button class="primary" id="open1">Open x1 (10)</button>
      <button id="open10">Open x10 (90)</button>
      <button id="reset">Reset</button>
      <button id="sound">Sound: On</button>
    </div>

    <div class="result" id="result" style="display:none;">
      <span class="rarity r-common" id="rarity">COMMON</span>
      <div class="itemName" id="item">â€”</div>
      <div class="small" id="desc">â€”</div>
      <div class="log" id="log"></div>
    </div>
  </div>
</div>

<script>
  // ---- State
  const coinsEl = document.getElementById('coins');
  const streakEl= document.getElementById('streak');
  const pityEl  = document.getElementById('pity');
  const bestEl  = document.getElementById('best');
  const area    = document.getElementById('area');
  const crate   = document.getElementById('crate');
  const flash   = document.getElementById('flash');
  const resBox  = document.getElementById('result');
  const rarityEl= document.getElementById('rarity');
  const itemEl  = document.getElementById('item');
  const descEl  = document.getElementById('desc');
  const logEl   = document.getElementById('log');
  const soundBtn= document.getElementById('sound');

  let coins = Number(localStorage.getItem('lb_coins')||100);
  let streak= Number(localStorage.getItem('lb_streak')||0);
  let pity  = Number(localStorage.getItem('lb_pity')||0);
  let bestR = Number(localStorage.getItem('lb_bestR')||0);
  let bestN = localStorage.getItem('lb_bestN')||"None";
  let sound = (localStorage.getItem('lb_sound')||"on")==="on";

  function save(){
    localStorage.setItem('lb_coins', coins);
    localStorage.setItem('lb_streak', streak);
    localStorage.setItem('lb_pity', pity);
    localStorage.setItem('lb_bestR', bestR);
    localStorage.setItem('lb_bestN', bestN);
    localStorage.setItem('lb_sound', sound?"on":"off");
  }
  function render(){
    coinsEl.textContent = coins;
    streakEl.textContent= streak;
    pityEl.textContent  = pity;
    bestEl.textContent  = bestN;
    soundBtn.textContent= "Sound: " + (sound?"On":"Off");
  }

  // ---- Sound (simple beeps using WebAudio)
  let ac=null;
  function beep(freq=660, dur=0.08){
    if(!sound) return;
    try{
      ac = ac || new (window.AudioContext||window.webkitAudioContext)();
      const o=ac.createOscillator(), g=ac.createGain();
      o.frequency.value=freq; o.type="sine";
      g.gain.value=0.04;
      o.connect(g); g.connect(ac.destination);
      o.start();
      setTimeout(()=>{o.stop();}, dur*1000);
    }catch(e){}
  }

  // ---- Loot table
  const items = {
    common: [
      ["Starter Badge", "å…¥é—¨å¾½ç« ï¼š+1 è‡ªä¿¡"],
      ["Basic Template", "åŸºç¡€æ¨¡æ¿ï¼šå¿«é€Ÿå¼€å·¥"],
      ["Mini Icon Set", "å°å›¾æ ‡ï¼šç‚¹ç¼€æ›´é«˜çº§"],
      ["Warm Copy Line", "ä¸€å¥æ–‡æ¡ˆï¼šæ›´ä¼šå–"]
    ],
    rare: [
      ["Rare Layout Pack", "ç¨€æœ‰æ’ç‰ˆï¼šæ›´æœ‰ç§©åº"],
      ["CTA Booster", "æŒ‰é’®æ–‡æ¡ˆï¼šæå‡ç‚¹å‡»"],
      ["Color Accent Kit", "é…è‰²å¼ºåŒ–ï¼šæ›´ç»Ÿä¸€"]
    ],
    epic: [
      ["Epic Landing Kit", "å²è¯—é”€å”®é¡µæ¨¡å—ï¼šç›´æ¥å¥—ç”¨"],
      ["Brand Grid System", "å“ç‰Œç½‘æ ¼ï¼šæ›´åƒå¤§ç‰Œ"],
      ["Conversion Script", "è½¬åŒ–è„šæœ¬ï¼šæ›´ä¼šå¼•å¯¼"]
    ],
    legend: [
      ["Legendary Bundle", "ä¼ è¯´å¥—è£…ï¼šä¸€å¥—èµ°å¤©ä¸‹"],
      ["Golden Template Pro", "é»‘é‡‘æ¨¡æ¿ï¼šé«˜çº§æ„Ÿæ‹‰æ»¡"]
    ]
  };

  // Rarity rank
  const rank = {common:1, rare:2, epic:3, legend:4};

  function rollOne(){
    // Base rates (with pity for legend)
    // common 72%, rare 20%, epic 7%, legend 1%
    // pity: every 20 opens guarantees legend if not hit
    pity += 1;

    let r=Math.random()*100;
    let rarity="common";
    if(pity>=20) { rarity="legend"; pity=0; }
    else if(r<1) { rarity="legend"; pity=0; }
    else if(r<8) rarity="epic";
    else if(r<28) rarity="rare";

    const pool = items[rarity];
    const pick = pool[Math.floor(Math.random()*pool.length)];
    return {rarity, name:pick[0], desc:pick[1]};
  }

  function flashBy(rarity){
    // flash strength by rarity
    flash.style.opacity = "0";
    flash.style.animation = "none";
    void flash.offsetWidth;

    let op = 0.18;
    if(rarity==="rare") op=0.28;
    if(rarity==="epic") op=0.36;
    if(rarity==="legend") op=0.48;
    flash.style.opacity = op;
    flash.style.animation = "spin .55s linear 1";
    setTimeout(()=>flash.style.opacity="0", 650);
  }

  function showResult(r){
    resBox.style.display="block";
    rarityEl.className = "rarity " + (
      r.rarity==="common"?"r-common":
      r.rarity==="rare"?"r-rare":
      r.rarity==="epic"?"r-epic":"r-legend"
    );
    rarityEl.textContent = r.rarity.toUpperCase();
    itemEl.textContent = r.name;
    descEl.textContent = r.desc;

    flashBy(r.rarity);
    crate.classList.remove("shake"); void crate.offsetWidth; crate.classList.add("shake");

    if(r.rarity==="common") beep(520,0.06);
    if(r.rarity==="rare") {beep(660,0.06); setTimeout(()=>beep(880,0.06),80);}
    if(r.rarity==="epic") {beep(660,0.07); setTimeout(()=>beep(990,0.08),80); setTimeout(()=>beep(1320,0.06),160);}
    if(r.rarity==="legend") {beep(660,0.09); setTimeout(()=>beep(990,0.09),90); setTimeout(()=>beep(1480,0.09),180); setTimeout(()=>beep(1980,0.09),270);}

    // best
    if(rank[r.rarity] > bestR){
      bestR = rank[r.rarity];
      bestN = r.name;
    }
    render();
    save();
  }

  function appendLog(text){
    const line = document.createElement("div");
    line.textContent = text;
    logEl.prepend(line);
  }

  function spend(cost){
    if(coins < cost) return false;
    coins -= cost;
    return true;
  }

  function openN(n, cost){
    if(!spend(cost)){
      resBox.style.display="block";
      rarityEl.className="rarity r-common";
      rarityEl.textContent="NO COINS";
      itemEl.textContent="Need more coins";
      descEl.textContent="ç‚¹ Reset é‡æ–°å¼€å§‹ï¼ˆæˆ–æˆ‘ä¹Ÿèƒ½å¸®ä½ åŠ â€œæ¯æ—¥ç­¾åˆ°â€æœºåˆ¶ï¼‰";
      return;
    }
    streak += 1;
    let last=null;
    for(let i=0;i<n;i++){
      const r = rollOne();
      last=r;
      appendLog(`${r.rarity.toUpperCase()} Â· ${r.name}`);
    }
    showResult(last);
    render();
    save();
  }

  // Actions
  document.getElementById('open1').addEventListener('click', ()=> openN(1,10));
  document.getElementById('open10').addEventListener('click', ()=> openN(10,90));
  document.getElementById('reset').addEventListener('click', ()=>{
    coins=100; streak=0; pity=0; bestR=0; bestN="None";
    logEl.innerHTML="";
    resBox.style.display="none";
    save(); render();
  });
  soundBtn.addEventListener('click', ()=>{ sound=!sound; save(); render(); beep(880,0.06); });

  area.addEventListener('click', ()=> openN(1,10));

  render();
</script>
</body>
</html>
